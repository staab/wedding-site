<html>
<head>
    <title>Jon and Valari</title>
    <script type="text/javascript" src="/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function(){
            $('#intro a').on('click', function(){
                $('#intro').hide();
                $('#form').show();
            });
            var showDetails = function(){
                $('#form').hide();
                $('#epilogue').show();
                $('#submit').addClass('inactive')
                    .attr('disabled', true)
                    .find('span').text('Thanks!')
                    .off();
            };
            $("#skip").on("click", showDetails);
            $('#submit').on('click', function(){
                var $this = $(this),
                    name = $('#guest_name').val(),
                    email = $('#guest_email').val(),
                    number = $('#guest_number').val();

                $('#error').hide();
                if(!name){
                    $('#error').show().text('Please enter your name!');
                    return false;
                }
                if(email.indexOf('@') < 3){
                    $('#error').show().text("Please enter a valid email!");
                    return false;
                }

                $.ajax({
                    url: '/register/',
                    data: {
                        name: name,
                        email: email,
                        number: number,
                        coming: $("#guest_coming").prop('checked'),
                        message: $("#guest_message").val()
                    },
                    success: showDetails,
                    error: function(res){
                        $('#error').show().text("Something went wrong with your registration. Sorry about that!");
                    }
                })
            });
            $('body').on('keydown', function(e){
                if(e.keyCode === 13 && $('#form').css('display') == 'block'){
                    $('#submit').trigger('click');
                }
            });
            $('#guest_coming').click(function(){
                $('.guest-number').toggle()
                $('select.guest-number').val(0)
            });
            $("#leave_message").click(function(){
                $("#guest_message").val("").toggle()
            });
        });
    </script>
    <link rel="stylesheet" type="text/css" href="/css/reset.css">
    <link rel="stylesheet" type="text/css" href="/css/base.css">
</head>
<body>
    <div id="wrapper">
        <div id="shadow">
            <div id="content">
                <div id="intro">
                    <h2>Welcome!</h2>
                    <a class="button">
                        <div class="body">
                            Rsvp...
                        </div>
                    </a>
                </div>
                <form id="form" action="#">
                    <h2>RSVP?</h2>
                    <p>Join us June 6, 2015 in Moscow, ID!</p>
                    <div id="error">
                        Nothin'
                    </div>
                    <div class="label-shadow"></div>
                    <label for="guest_name">Name: </label>
                    <input type="text" id="guest_name"></input>

                    <div class="label-shadow"></div>
                    <label for="guest_email">Email: </label>
                    <input type="text" id="guest_email"></input>

                    <div class="label-shadow"></div>
                    <label for="guest_coming">Coming?</label>
                    <input type="checkbox" id="guest_coming" checked="checked"></input>

                    <div class="label-shadow guest-number"></div>
                    <label for="guest_number" class='guest-number'>Guests: </label>
                    <select id="guest_number" class="guest-number">
                        <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                    </select>

                    <div class="label-shadow full-width"></div>
                    <label for="guest_message" class="full-width" id="leave_message">Want to leave a message?</label>
                    <textarea rows="8" id="guest_message" class="full-width"></textarea>

                    <a class="button" id="submit">
                        <div class="body">
                            <span>Let us know!</span>
                        </div>
                    </a>
                    <a id="skip" style="font-size: 10px;">Already registered?</a>
                </form>
                <div id="epilogue">
                    <h2>Thanks!</h2>
                    <h3>Stuff you might want to know now...</h3>
                    <ol>
                        <li>
                            <h4>Ceremony location:</h4>
                        </li>
                        <li class="list-shadow"></li>
                        <li>
                            <h4>Registry providers:</h4>
                            <ul>
                            </ul>
                        </li>
                        <li class="list-shadow"></li>
                    </ol>
                    <div id="more">
                        <a href="/slideshow/">
                            More &rtrif;
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
